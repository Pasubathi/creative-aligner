<nav class="page-breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a routerLink="/dashboard/cases">Cases</a></li>
    <li class="breadcrumb-item active" aria-current="page">Case Review</li>
  </ol>
</nav>


<div class="card">
  <div class="card-body">
    <div *ngIf="isLoading">Loading ......</div>
    <ul ngbNav #defaultNav="ngbNav" class="nav-tabs mt-3">
      <li [ngbNavItem]="1">
        <a ngbNavLink>Digital Setups</a>
        <ng-template ngbNavContent>

          <div class="row" style="padding: 10px">
            <div class="col-sm-7">
              <div class="mb-3" style="display:flex">
                <img width="150" height="150" [src]="imgUrl" style="background: url(assets/images/placeholderimages/front_smiling.svg); margin-right: 20px" />
                <table>
                  <tr>
                    <td><span class="mb-3 text-muted">Patient Name: </span></td>
                    <td> <span class="mb-3">{{api.case.Data.FirstName}} {{api.case.Data.LastName}}</span></td>
                  </tr>
                  <tr>
                    <td><span class="mb-3 text-muted">Case No.: </span></td>
                    <td> <span class="mb-3">{{api.case.Data.CaseNumber}}</span></td>
                  </tr>
                  <tr>
                    <td><span class="mb-3 text-muted">Case Status: </span></td>
                    <td> <span class="mb-3">{{api.case.Data.getCaseStage}}</span></td>
                  </tr>
                  <tr>
                    <td><span class="mb-3 text-muted">Package: </span></td>
                    <td> <span class="mb-3">{{api.case.PackageName()}}</span></td>
                  </tr>
                </table>
              </div>
            </div>
            <div class="col-sm-5"></div>
          </div>

          <app-case-revisions-list [case]="api.case" [isOrthodontist]="false" [isAdmin]="false" [isDoctor]="auth.isDoctor()"></app-case-revisions-list>
          <app-case-shipping [case]="api.case"></app-case-shipping>
        </ng-template>
      </li>
      <li [ngbNavItem]="2">
        <a ngbNavLink>Details</a>
        <ng-template ngbNavContent>
          <app-case-review-details [caseData]="api.case"></app-case-review-details>
        </ng-template>
      </li>
      <li [ngbNavItem]="3">
        <a ngbNavLink>Records</a>
        <ng-template ngbNavContent>
          <app-case-records [case]="api.case.Data"></app-case-records>
        </ng-template>
      </li>
      <li [ngbNavItem]="4">
        <a ngbNavLink>Chat</a>
        <ng-template ngbNavContent>
          <app-chat></app-chat>
        </ng-template>
      </li>
      <li [ngbNavItem]="5">
        <a ngbNavLink>History</a>
        <ng-template ngbNavContent>
          <app-case-history [historyRecords]="api.case.HistoryRecords"></app-case-history>
        </ng-template>
      </li>
    </ul>

    <div *ngIf="!isLoading" [ngbNavOutlet]="defaultNav" class="mt-3"></div>

    <div class="row">
      <hr />
      <br />
    </div>
    <div *ngIf="api.case.Data.CaseStage == 'ReadyForImpressionsCollection'">
      <div class="row">
        <div class="col-sm-12">
          <div class="d-flex justify-content-center mt-2">
            <button type="button" class="btn btn-primary me-2" (click)="isImpressionCollapsed = !isImpressionCollapsed"
                    [attr.aria-expanded]="!isImpressionCollapsed" aria-controls="impressionsShipped">
              <span style="white-space:nowrap">
                Impressions Shipped
              </span>
            </button>
          </div>
        </div>
      </div><!-- Row-->
      <div id="impressionsShipped" [ngbCollapse]="isImpressionCollapsed">
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="d-flex justify-content-center mt-2">
                <button type="button" class="btn btn-primary me-2" [disabled]="savingCase" (click)="impressions_Shipped()">
                  <span style="white-space:nowrap">
                    <span [style.visibility]="savingCase && isImpression ? 'visible' : 'hidden'"
                          class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    Confirm
                  </span>
                </button>
              </div>
            </div> <!-- Row-->
          </div>
        </div>
      </div>
    </div>
    <div>
      <div class="row">
        <div class="col-sm-12">
          <div class="d-flex justify-content-center mt-2">
            <button *ngIf="api.case.Data.CaseStage=='Active' && api.case.Package.Package == 'Unlimited'" type="button" class="btn btn-primary me-2" (click)="doRequestNextShipment()"
                    aria-controls="nextShipment">
              <i class="feather icon-command icon-xs me-2"></i>
              <span style="white-space:nowrap">
                Request Next Shipment
              </span>
            </button>
            <button *ngIf="api.case.Data.CaseStage=='Active' && api.case.Package.Package == 'Unlimited'" type="button" class="btn btn-primary me-2" (click)="doRequestMidcourseAdjusment()"
                    aria-controls="midcourse">
              <i class="feather icon-command icon-xs me-2"></i>
              <span style="white-space:nowrap">
                Request Midcourse Adjusment
              </span>
            </button>
            <button *ngIf="api.case.Data.CaseStage=='Active'" type="button" class="btn btn-primary me-2" (click)="doReplaceMissing()"
                    aria-controls="replaceMissing">
              <i class="feather icon-command icon-xs me-2"></i>
              <span style="white-space:nowrap">
                Request Replace Missing
              </span>
            </button>
            <button *ngIf="api.case.Data.CaseStage=='Active'" type="button" class="btn btn-primary me-2" (click)="doRequestRefinments()"
                    aria-controls="requestRefinments">
              <i class="feather icon-command icon-xs me-2"></i>
              <span style="white-space:nowrap">
                Request Refinements
              </span>
            </button>
            <button *ngIf="api.case.Data.CaseStage=='Active'" type="button" class="btn btn-primary me-2" (click)="doRequestRetainer()"
                    aria-controls="requestRetainer">
              <i class="feather icon-command icon-xs me-2"></i>
              <span style="white-space:nowrap">
                Request Retainer
              </span>
            </button>
            <button type="button" class="btn btn-primary me-2" (click)="doArchived()"
                    aria-controls="requestArchive">
              <i class="feather icon-archive icon-xs me-2"></i>
              <span style="white-space:nowrap">
                Archive
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-case-post #postcase></app-case-post>
