<nav class="page-breadcrumb">
  <ol class="breadcrumb">
      <li *ngIf="auth.isDoctor()" class="breadcrumb-item"><a href="/dashboard/cases">Cases</a></li>
      <li *ngIf="auth.isDoctor()" class="breadcrumb-item"><a [href]="'/case/case-review;id='+caseID">Case Review</a></li>
      <li *ngIf="!auth.isDoctor()" class="breadcrumb-item"><a href="/admin/home">Cases</a></li>
      <li *ngIf="!auth.isDoctor()" class="breadcrumb-item"><a [href]="'/admin/admin-case-review;id='+caseID">Case Review</a></li>
      <li class="breadcrumb-item active" aria-current="page">Digital Setup</li>
  </ol>
</nav>
<div class="card">
  <div class="card-body">
    <div class="row" *ngIf="isLoading == 1">
      <div class="col-lg-7">
        <div *ngIf="sanDesignEmbededURL">
          <iframe id="ctr3d" style="width: 100%;height:550px;overflow-y:scroll" frameborder="0" allowfullscreen
            [src]="sanDesignEmbededURL">
          </iframe>
        </div>
      </div>
      <div class="col-lg-5">
        <ul ngbNav #defaultNav="ngbNav" class="nav-tabs">
          <li [ngbNavItem]="1">
            <a ngbNavLink>IPR Report</a>
            <ng-template ngbNavContent>
              <div>
                <app-ipr-teeth *ngIf="showIPR()" [IsReadOnly]="true" [Data]="Data" #ipr_teeth></app-ipr-teeth>
                <p *ngIf="!showIPR()" class="d-flex justify-content-center mt-2">CASE DOSENT CONTAIN IPR</p>

                <div>
                  <h6 class="fw-bold mt-4 mb-2"><span class="text-muted">Designer Notes:</span></h6>
                  <div>
                    {{Data.Revision.DesignerNotes}}
                  </div>
                </div>
              </div>
            </ng-template>
          </li>
          <li [ngbNavItem]="2">
            <a ngbNavLink>Upper Teeth Move Chart</a>
            <ng-template ngbNavContent>
              <div>
                <div *ngIf="Data && showUpper()">

                  <div class="table-responsive">
                    <table class="table table-hover mb-0">
                      <thead>
                        <tr>
                          <ng-container *ngFor="let item of Data.UpperIprAmount; let i=index;">
                            <th class="pt-0" *ngIf="i == 0">Tooth</th>
                            <th class="pt-0">
                              {{item.LabelUp}}
                            </th>
                          </ng-container>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngIf="showTeeth(Data.UStripMesial)">
                          <ng-container *ngFor="let item of Data.UStripMesial; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.UStripDistal)">
                          <ng-container *ngFor="let item of Data.UStripDistal; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.UInclination)">
                          <ng-container *ngFor="let item of Data.UInclination; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.UInclinationStep)">
                          <ng-container *ngFor="let item of Data.UInclinationStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.UAngulation)">
                          <ng-container *ngFor="let item of Data.UAngulation; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.UAngulationStep)">
                          <ng-container *ngFor="let item of Data.UAngulationStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.URotationStep)">
                          <ng-container *ngFor="let item of Data.URotationStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.UMesialStep)">
                          <ng-container *ngFor="let item of Data.UMesialStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.UVestibularStep)">
                          <ng-container *ngFor="let item of Data.UVestibularStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.UOcclusalStep)">
                          <ng-container *ngFor="let item of Data.UOcclusalStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                </div>
              </div>
            </ng-template>
          </li>
          <li [ngbNavItem]="3">
            <a ngbNavLink>Lower Teeth Move Chart</a>
            <ng-template ngbNavContent>
              <div>
                <div *ngIf="Data && showLower()">

                  <div class="table-responsive">
                    <table class="table table-hover mb-0">
                      <thead>
                        <tr>
                          <ng-container *ngFor="let item of Data.UpperIprAmount; let i=index;">
                            <th class="pt-0" *ngIf="i == 0">Tooth</th>
                            <th class="pt-0">
                              {{(Data.HasBothLabel ? item.LabelDown : item.LabelUp)}}
                            </th>
                          </ng-container>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngIf="showTeeth(Data.LStripMesial)">
                          <ng-container *ngFor="let item of Data.LStripMesial; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.LStripDistal)">
                          <ng-container *ngFor="let item of Data.LStripDistal; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.LInclination)">
                          <ng-container *ngFor="let item of Data.LInclination; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.LInclinationStep)">
                          <ng-container *ngFor="let item of Data.LInclinationStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.LAngulation)">
                          <ng-container *ngFor="let item of Data.LAngulation; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.LAngulationStep)">
                          <ng-container *ngFor="let item of Data.LAngulationStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.LRotationStep)">
                          <ng-container *ngFor="let item of Data.LRotationStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.LMesialStep)">
                          <ng-container *ngFor="let item of Data.LMesialStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.LVestibularStep)">
                          <ng-container *ngFor="let item of Data.LVestibularStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                        <tr *ngIf="showTeeth(Data.LOcclusalStep)">
                          <ng-container *ngFor="let item of Data.LOcclusalStep; let i=index;">
                            <td *ngIf="i == 0">{{item.LabelUp}}</td>
                            <td>
                              {{item.RowValue}}
                            </td>
                          </ng-container>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </ng-template>
          </li>
        </ul>

        <br />
        <div [ngbNavOutlet]="defaultNav" class="mt-3"></div>
        <hr />
        <div *ngIf="auth.isOrthodontist() && api.case.Data.CaseStage=='PendingOrthodontistApproval' && Data.IsActive">
          <div class="row">
            <div class="col-sm-12">
              <div class="d-flex justify-content-center mt-2">
                <button type="button" class="btn btn-danger me-2"
                  (click)="isOrthodontistCollapsed = !isOrthodontistCollapsed ; Data.Revision.OrthodontistNotes=''"
                  [attr.aria-expanded]="!isOrthodontistCollapsed" aria-controls="reviseRevision">
                  <span style="white-space:nowrap">
                    Revise Design
                  </span>
                </button>
                <button type="button" class="btn btn-primary me-2" [disabled]="savingCase"
                  (click)="updateCaseStatus('isApprove','PendingTSApproval')">
                  <span style="white-space:nowrap">
                    <span [style.visibility]="savingCase ? 'visible' : 'hidden'"
                      class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    Approve Design
                  </span>
                </button>
              </div>
            </div>
          </div><!-- Row-->
          <div id="reviseRevision" [ngbCollapse]="isOrthodontistCollapsed">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col-sm-12">
                    <label for="reviseNotes" class="form-label">Orthodontist Revision Notes:</label>
                    <textarea class="form-control" [(ngModel)]="Data.Revision.OrthodontistNotes" id="reviseNotes"
                      rows="2"></textarea>
                  </div>
                </div><!-- Row-->
                <div class="row">
                  <div class="d-flex justify-content-center mt-2">
                    <button type="button" class="btn btn-danger me-2" [disabled]="savingCase"
                      (click)="orthodontistRevise()">
                      <span style="white-space:nowrap">
                        <span [style.visibility]="savingCase && isReturn ? 'visible' : 'hidden'"
                          class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Revise Design
                      </span>
                    </button>
                  </div>
                </div> <!-- Row-->
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="api.case.Data.CaseStage=='PendingTSApproval' && auth.isDoctor()">
          <div class="row">
            <div class="col-sm-12">
              <div class="d-flex justify-content-center mt-2">
                <button type="button" class="btn btn-danger me-2"
                  (click)="reviseRevision()"
                  [attr.aria-expanded]="!isReviseRevisionCollapsed" aria-controls="reviseRevision" *ngIf="Data.IsActive">
                  <span style="white-space:nowrap">
                    Revise Treatment
                  </span>
                </button>
                <button type="button" class="btn btn-primary me-2" [disabled]="savingCase"
                  (click)="approveRevision()">
                  <span style="white-space:nowrap">
                    <span [style.visibility]="savingCase ? 'visible' : 'hidden'"
                      class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    Approve Treatment
                  </span>
                </button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div *ngIf="isLoading == 0">Loading ......</div>
    <div *ngIf="isLoading == 1">

      <br />


    </div>
    <div *ngIf="isLoading == 2">{{errorMessage}}</div>
  </div>
</div>

<app-post-revision #postrevision></app-post-revision>